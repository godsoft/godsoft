<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Goods">

	<typeAlias alias="egovMap"
		type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="searchVO" type="egovframework.rte.rex.com.service.SearchVO" />

	<resultMap id="goods" class="egovframework.rte.rex.gds.service.GoodsVO">
		<result property="goodsId" column="goods_id" />
		<result property="goodsNm" column="goods_nm" />
		<result property="price" column="price" />
		<result property="goodsImageVO" resultMap="Goods.goodsImage" />
		<result property="makr" column="makr" />
		<result property="detailImageVO" resultMap="Goods.detailImage" />
		<result property="useAt" column="use_at" />
	</resultMap>

	<resultMap id="goodsImage"
		class="egovframework.rte.rex.gds.service.GoodsImageVO">
		<result property="goodsImageId" column="goods_image_id" />
		<result property="fileNm" column="file_nm" />
	</resultMap>

	<resultMap id="detailImage"
		class="egovframework.rte.rex.gds.service.GoodsImageVO">
		<result property="goodsImageId" column="detail_info_image_id" />
		<result property="fileNm" column="detail_file_nm" />
	</resultMap>

	<select id="goodsDAO.selectGoodsList" parameterClass="searchVO"
		resultClass="egovMap">
				
		<![CDATA[
            SELECT  *
              FROM  (
            SELECT ROWNUM RNUM, ALL_LIST.*
              FROM  (
        ]]>
        <![CDATA[
			SELECT
				GOODS_ID, GOODS_NM, PRICE, GOODS_IMAGE_ID
			FROM RTETNGOODS
			WHERE USE_AT='1'  ]]>
			<isNotEmpty prepend="AND" property="searchKeyword"> 
				<![CDATA[GOODS_NM LIKE CONCAT('%',CONCAT(#searchKeyword#,'%'))]]>
			</isNotEmpty>
		<![CDATA[	ORDER BY GOODS_ID DESC
				) ALL_LIST
				)
				  WHERE  RNUM  > #firstIndex#
	               AND  RNUM <= #firstIndex# + #recordCountPerPage#]]>
	</select>

	<select id="goodsDAO.selectGoodsListTotCnt" parameterClass="searchVO" resultClass="int">
			<![CDATA[SELECT COUNT(*) totcnt
						FROM RTETNGOODS
						WHERE USE_AT = '1']]>
		<isNotEmpty prepend="AND" property="searchKeyword"> 
			<![CDATA[GOODS_NM LIKE CONCAT('%',CONCAT(#searchKeyword#,'%'))]]>
		</isNotEmpty>
	</select>
	
	<select id="goodsDAO.selectGoodsXml" resultMap="goods">
		<![CDATA[	
			SELECT
				G.GOODS_ID, G.GOODS_NM, G.PRICE, G.GOODS_IMAGE_ID, G.MAKR, C.CTGRY_ID, C.CTGRY_NM, I.GOODS_IMAGE_ID, I.FILE_NM, D.GOODS_IMAGE_ID DETAIL_INFO_IMAGE_ID, D.FILE_NM detail_file_nm, G.USE_AT
			FROM 
				RTETNGOODS G, RTETNCTGRY C, RTETNGOODSIMAGE I, RTETNGOODSIMAGE D
			WHERE 
				G.CTGRY_ID = C.CTGRY_ID 
				AND G.GOODS_IMAGE_ID=I.GOODS_IMAGE_ID
				AND G.DETAIL_INFO_IMAGE_ID=D.GOODS_IMAGE_ID
				AND G.USE_AT = '1'
			ORDER BY GOODS_ID DESC
		 ]]>
	</select>

</sqlMap>
